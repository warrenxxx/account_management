!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=11)}([function(e,t,o){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(o(6));t.AppError=class{constructor(e,t,o,n,r,s){this.errorNameException=e,this.name=e,this.message=t,this.errorValues=o,this.errorCode=n,this.messageSystem=r,this.errorDate=new Date,this.userName=s,this.saveError()}saveError(){r.default.getDbMultitenant("common").collection("error").insertOne(this).then()}};t.ErrorValue=class{constructor(e,t){this.key=e,this.value=t}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors={UserNotFoundError:{code:1e3,name:"ObjectNotFoundException",message:"El usuario con nombre $name no existe"},ValidateRequestError:{code:2e3,name:"ValidationException",message:"El objeto no cumple con los requisitos"},LoginError:{code:3e3,name:"AuthenticationException",message:"El usuario no coincide con la contraseÃ±a"},TokenExpirationError:{code:3010,name:"AuthenticationException",message:"El token ingresado expiro"},AuthorizationError:{code:3020,name:"AuthorizationException",message:"El usuario no tiene permiso para acceder a $1"},AuthenticationErrorGlobal:{code:3021,name:"AuthorizationException",message:""},ObjectNullError:{code:4e3,name:"ObjectNullError",message:"El objeto es nulo = "},HeaderError:{code:5e3,name:"HeaderError",message:"El header con el parametro : $1 no existe"},SystemError:{code:9e3,name:"SystemError",message:"El sistema presenta el siguiente error : "}}},function(e,t){e.exports=require("bson")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.env={mongo:{url:"mongodb://localhost:27017",db:"dbMicap",common:"mongodb://localhost:27017/common",c0:"mongodb://localhost:27017/common",c1:"mongodb://localhost:27017/c1",c2:"mongodb://localhost:27017/c2",c3:"mongodb://localhost:27017/c3",c4:"mongodb://localhost:27017/c4",c5:"mongodb://localhost:27017/c5",c6:"mongodb://localhost:27017/c6",c7:"mongodb://localhost:27017/c7",c8:"mongodb://localhost:27017/c8",c9:"mongodb://localhost:27017/c9",c10:"mongodb://localhost:27017/c10"},mongoTest:{url:"mongodb://localhost:27017",db:"dbMicapTest"},port:{authentication:3e3,userManagement:3001,roleManagement:3002,functionManagement:3003,productoManagement:3004},privateKey:"clver princada con erroes",privateKeyToResetPaaword:"clver princada con erroes 2",privateKeyToConfimrEmail:"clver princada con erroes 2 me lo lloro",hostFront:"http://localhost:4200",oauth:{github:{clientId:"917d9ea48c6079361db7",secret:"95f840d74161b2031e5bc5ae030fdd6d9e4aa435"},google:{clientId:"169588101511-s41mv83ehmd7d1e18liaos8uqrl1v505.apps.googleusercontent.com",secret:"UKCbrNz-s7fByse9LLYb2ynI",redirect_uri:"http://localhost:3000/authentication/google"},facebook:{clientId:"972932186189099",secret:"3f5781eeb24a6eb56ea309539a7a9d84",redirect_uri:"http://localhost:3000/authentication/facebook"}},email:{user:"100505@unsaac.edu.pe",password:"alizonmelani123k",host:"smtp.gmail.com",server:"gmail"}}},function(e,t){e.exports=require("express")},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,s){function i(e){try{a(n.next(e))}catch(e){s(e)}}function c(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(i,c)}a((n=n.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(o(18)),i=o(19),c=o(20),a=o(2);function u(e,t){const o={};for(const n in t)if(s.default.isArray(t[n])){if(!s.default.isArray(e[n]))throw i.ValidationError.ValidateObjectException(n);{const r=[];if(s.default.isFunction(t[n][0]))for(const o of e[n]){const e=t[n][0](o);if(!e)throw i.ValidationError.ValidateObjectException(n);r.push(e)}else for(const o of e[n])r.push(u(o,t[n][0]));o[n]=r}}else if(s.default.isFunction(t[n])){const r=t[n](e[n]);if(!r)throw i.ValidationError.ValidateObjectException(n);o[n]=r}else o[n]=u(e[n],t[n]);return o}t.Validate=function(e,t){return n(this,void 0,void 0,function*(){try{return u(e,t)}catch(e){throw e}})},t.isString=function(e,t=0,o=300){return s.default.isString(e)&&e.length>=t&&e.length<=o?e:null},t.isStringRegex=function(e,t){return s.default.isString(e)&&t.test(e)?e:null},t.isNumber=function(e){return s.default.isNumber(e)?e:null},t.isBoolean=function(e){return s.default.isBoolean(e)?e:null},t.isObjectId=function(e){return a.ObjectId.isValid(e)?new a.ObjectId(e):null},t.isDate=function(e){const t=c(e,"DD-MM-YYYY",!0);return t.isValid()?t.toDate():null},t.isDateTime=function(e){const t=c(e,"DD-MM-YYYY HH:mm:ss",!0);return t.isValid()?t.toDate():null},t.isValid=u},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,s){function i(e){try{a(n.next(e))}catch(e){s(e)}}function c(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(i,c)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=o(7),s=o(3);class i{constructor(){}static connect(e,t){return n(this,void 0,void 0,function*(){try{yield r.MongoClient.connect(e,{useNewUrlParser:!0});return e+" - "+t}catch(e){throw e}})}static connectMultitenant(e){return n(this,void 0,void 0,function*(){const t=yield r.MongoClient.connect(e,{useNewUrlParser:!0});return i.dbs[t.db().databaseName]=t.db(),t.db()})}static getDbMultitenant(e){if(e&&this.dbs[e])return this.dbs[e]}}i.dbs={},t.MongoConfig=i,i.connectMultitenant(s.env.mongo.c0).then(e=>console.log("connect c0")).then(e=>i.connectMultitenant(s.env.mongo.c1)).then(e=>console.log("connect c1")).then(e=>i.connectMultitenant(s.env.mongo.c2)).then(e=>console.log("connect c2")).then(e=>i.connectMultitenant(s.env.mongo.c3)).then(e=>console.log("connect c3")).then(e=>i.connectMultitenant(s.env.mongo.c4)).then(e=>console.log("connect c4")).then(e=>i.connectMultitenant(s.env.mongo.c5)).then(e=>console.log("connect c5")).then(e=>i.connectMultitenant(s.env.mongo.c6)).then(e=>console.log("connect c6")).then(e=>i.connectMultitenant(s.env.mongo.common)).then(e=>console.log("connect common")),t.default=i},function(e,t){e.exports=require("mongodb")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(2);class r{constructor(){this.createdLocalDate=new Date,this.modifiedLocalDate=new Date,this.modifiedBy=new n.ObjectID,this.createdBy=new n.ObjectID}static newAuditStatic(e){const t=new r;return t.newAudit(e),t}newAudit(e){this.modifiedBy=new n.ObjectId(e),this.createdBy=new n.ObjectId(e),this.modifiedLocalDate=new Date,this.createdLocalDate=new Date}actAudit(e){this.modifiedBy=new n.ObjectId(e),this.modifiedLocalDate=new Date}}t.AuditModel=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(21);class s{constructor(e,t){this.data=e,this.error=t}static ok(){return new s("ok",null)}static okObject(e){return new s(e,null)}static okCount(e){return new s({message:"ok",numInserted:e},null)}static errorResponse(e){return e instanceof n.AppError?new s(null,e):new s(null,r.SystemError.MessageError(e.message))}}t.AppResponse=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(7);t.BaseMongoImpDao=class{constructor(e){this.collection=e}count(e){return e.collection(this.collection).countDocuments()}findAll(e){return e.collection(this.collection).find().map(e=>(e.audit=void 0,e)).toArray()}findById(e,t){return e.collection(this.collection).findOne({_id:t})}insert(e,t){return e.collection(this.collection).insertOne(t).then(e=>e.ops[0])}removeById(e,t){return e.collection(this.collection).deleteOne({_id:t}).then(e=>e.deletedCount)}update(e,t){const o=t._id;return delete t._id,e.collection(this.collection).updateOne({_id:o},{$set:t}).then(e=>t)}existsById(e,t){return e.collection(this.collection).findOne({_id:new n.ObjectId(t)}).then(e=>!!e)}}},function(e,t,o){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(o(12)),i=r(o(13)),c=o(3),a=function(e){const t="string"==typeof e?parseInt(e,10):e;return isNaN(t)?e:t>=0&&t}(process.env.PORT||c.env.port.userManagement||3e3);i.default.set("port",a);const u=s.createServer(i.default);u.listen(a),u.on("error",function(e){if("listen"!==e.syscall)throw e;const t="string"==typeof a?"Pipe "+a:"Port "+a;switch(e.code){case"EACCES":console.error(`${t} requires elevated privileges`),process.exit(1);break;case"EADDRINUSE":console.error(`${t} is already in use`),process.exit(1);break;default:throw e}}),u.on("listening",function(){const e=u.address(),t="string"==typeof e?`pipe ${e}`:`port ${e.port}`;console.log(`Server listening on port ${t}`)})},function(e,t){e.exports=require("http")},function(e,t,o){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(o(14)),i=r(o(15)),c=r(o(4)),a=o(3),u=o(16),d=r(o(6)),l=new u.Controller;t.default=(new class{constructor(){this.app=c.default(),this.env(),this.routes(),this.initPasspotRoutes(),this.initDatabase()}env(){this.app.use(s.urlencoded({extended:!0})),this.app.use(s.json()),this.app.use(i.default()),this.app.use((e,t,o)=>{t.header("Access-Control-Allow-Origin","http://localhost:4200"),t.header("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, Authorization, Access-Control-Allow-Credentials"),t.header("Access-Control-Allow-Credentials","true"),o()})}routes(){this.app.use("/account",l.router)}initDatabase(){d.default.connect(a.env.mongo.url,a.env.mongo.db).then(e=>{console.log("Connect to db",e)})}initPasspotRoutes(){}}).app},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cors")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(4),r=o(17),s=o(2),i=o(5),c=o(9),a=o(22),u=new(o(27).Service);t.Controller=class{constructor(){this.router=n.Router(),this.router.post("/",a.fromJwt,this.insert),this.router.get("/:id",a.fromJwt,this.readOne),this.router.get("/",a.fromJwt,this.readAll),this.router.put("/:id",a.fromJwt,this.update),this.router.delete("/:id",a.fromJwt,this.delete)}insert(e,t){i.Validate(e.body,r.AccountDtoRules).then(e=>r.dtoToAccount(e)).then(t=>u.insert(e.db,t,e._id)).then(e=>t.status(200).send(e)).catch(e=>t.status(400).send(c.AppResponse.errorResponse(e)))}readOne(e,t){u.readOne(e.db,new s.ObjectId(e.params.id)).then(e=>t.status(200).send(e)).catch(e=>t.status(400).send(c.AppResponse.errorResponse(e)))}readAll(e,t){u.readAll(e.db).then(e=>t.status(200).send(e)).catch(e=>t.status(400).send(c.AppResponse.errorResponse(e)))}update(e,t){i.Validate(e.body,r.AccountDtoRules).then(t=>r.dtoToAccount(t,new s.ObjectId(e.params.id))).then(t=>u.update(e.db,t,e._id)).then(e=>t.status(200).send(e)).catch(e=>t.status(400).send(c.AppResponse.errorResponse(e)))}delete(e,t){u.delete(e.db,new s.ObjectId(e.params.id)).then(e=>t.status(200).send({count:e})).catch(e=>{throw t.status(400).send(c.AppResponse.errorResponse(e)),e})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(5),r=o(2),s=o(8);t.AccountDtoRules={userName:e=>n.isString(e),password:e=>n.isString(e),email:e=>n.isString(e),firstName:e=>n.isString(e),lastName:e=>n.isString(e),birthDate:e=>n.isString(e),gender:e=>n.isString(e),functions:[e=>n.isString(e)],roles:[e=>n.isString(e)],enabled:e=>n.isBoolean(e)},t.dtoToAccount=function(e,t=new r.ObjectId){return{_id:t,userName:{id:e.userName,serverResource:"local"},password:e.password,email:e.email,roles:e.roles,functions:e.functions,enabled:e.enabled,user:{birthDate:e.birthDate,firstName:e.firstName,gender:e.gender,lastName:e.lastName},audit:new s.AuditModel}}},function(e,t){e.exports=require("validate.js")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(1);class s extends n.AppError{constructor(e,t,o){super(s.name,e,[],t,"",o)}static ValidateRequestException(e){const t=r.errors.ValidateRequestError;return new s(t.message+" "+e,t.code,"")}static ValidateObjectException(e){const t=r.errors.ValidateRequestError;return new s(t.message+" "+e,t.code,"")}}t.ValidationError=s},function(e,t){e.exports=require("moment")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(1);class s extends n.AppError{constructor(e,t,o){super(s.name,e,[],t,"",o)}static MessageError(e){const t=r.errors.SystemError;return new s(t.message+" "+e,t.code,"")}}t.SystemError=s},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,s){function i(e){try{a(n.next(e))}catch(e){s(e)}}function c(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(i,c)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=o(23),s=o(9),i=o(24),c=o(25),a=o(26),u=o(3);t.fromJwt=function(e,t,o){const n=e.header("Authorization"),d=e.method,l=e.baseUrl,p=e.route.path;if(!n)return t.status(400).send(s.AppResponse.errorResponse(r.HeaderError.AuthorizationHeaderError("Authorization")));try{const r=i.verify(n,u.env.privateKey);if("/authentication"===l&&"/refresh_token"===p)return e._id=r.id,e.userName=r.userName,o();const h=r.functions;for(const n of h)if("/"+n._id===l)return"GET"===d&&"/"===p&&-1!==n.methods.indexOf("ra")?(e._id=r.id,e.userName=r.userName,o()):"GET"===d&&"/:id"===p&&-1!==n.methods.indexOf("ro")?(e._id=r.id,e.userName=r.userName,o()):"POST"===d&&"/"===p&&-1!==n.methods.indexOf("c")?(e._id=r.id,e.userName=r.userName,o()):"PUT"===d&&"/:id"===p&&-1!==n.methods.indexOf("u")?(e._id=r.id,e.userName=r.userName,o()):"DELETE"===d&&"/:id"===p&&-1!==n.methods.indexOf("d")?(e._id=r.id,e.userName=r.userName,o()):t.status(400).send(s.AppResponse.errorResponse(a.AuthorizationError.NoHasError(e.originalUrl+" "+e.method)));return t.status(400).send(s.AppResponse.errorResponse(a.AuthorizationError.NoHasError(e.originalUrl+" "+e.method)))}catch(e){return"jwt expired"!==e.message?t.status(400).send(s.AppResponse.errorResponse(e)):t.status(400).send(s.AppResponse.errorResponse(c.AuthenticationError.TokenExpiration()))}},t.tojwt=function(e,t){return n(this,void 0,void 0,function*(){const o={id:e._id,userName:e.userName,functions:t};let n;try{n=yield i.sign(o,u.env.privateKey,{expiresIn:"40000s"})}catch(e){throw e}return n})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(1);class s extends n.AppError{constructor(e,t,o){super(s.name,e,[],t,"",o)}static AuthorizationHeaderError(e){const t=r.errors.HeaderError;return new s(t.message.replace("$1",e),t.code,"")}}t.HeaderError=s},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(1);class s extends n.AppError{constructor(e,t,o){super(s.name,e,[],t,"",o)}static LoginError(e){const t=r.errors.LoginError;return new s(t.message,t.code,e)}static TokenExpiration(){const e=r.errors.TokenExpirationError;return new s(e.message,e.code,"")}static resetPasswordWithoutLocal(){return new s("El email ingresado no es un email local",22,"")}}t.AuthenticationError=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(1);class s extends n.AppError{constructor(e,t,o){super(s.name,e,[],t,"",o)}static NoHasError(e){const t=r.errors.AuthorizationError;return new s(t.message.replace("$1",e),t.code,"")}}t.AuthorizationError=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(28),r=o(31);t.Service=class extends n.BaseMongoService{constructor(){super(r.nameColection)}}},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,s){function i(e){try{a(n.next(e))}catch(e){s(e)}}function c(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(i,c)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=o(2),s=o(8),i=o(10),c=o(29),a=o(30);t.BaseMongoService=class{constructor(e){this.dao=new i.BaseMongoImpDao(e)}insert(e,t,o){return n(this,void 0,void 0,function*(){return t.audit=s.AuditModel.newAuditStatic(o),this.dao.insert(e,t).then(e=>(delete e.audit,e))})}readOne(e,t){return n(this,void 0,void 0,function*(){if(t)return this.dao.findById(e,t).then(e=>{if(e)return delete e.audit,delete e.password,e;throw new a.ObjectNotFoundError});throw c.ObjectNullError.ValidateRequestException("id")})}readAll(e){return n(this,void 0,void 0,function*(){return this.dao.findAll(e).then(e=>(e.forEach(e=>{e.audit&&(e.audit=void 0),e.password&&(e.password=void 0)}),e))})}update(e,t,o){return n(this,void 0,void 0,function*(){return this.dao.findById(e,t._id).then(e=>{if(e)return e.audit.modifiedBy=new r.ObjectId(o),e.audit.modifiedLocalDate=new Date,t.audit=e.audit,t;throw a.ObjectNotFoundError.UserNotFoundException("")}).then(t=>this.dao.update(e,t)).then(e=>(delete e.audit,e))})}delete(e,t){return n(this,void 0,void 0,function*(){return this.dao.findById(e,t).then(o=>{if(o)return this.dao.removeById(e,t);throw new a.ObjectNotFoundError})})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(1);class s extends n.AppError{constructor(e,t,o){super(s.name,e,[],t,"",o)}static ValidateRequestException(e){const t=r.errors.ValidateRequestError;return new s(t.message+" "+e,t.code,"")}}t.ObjectNullError=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),r=o(1);class s extends n.AppError{constructor(e="El Objeto no Existe",t=7e4,o=""){super(s.name,e,[],t,"",o)}static UserNotFoundException(e){const t=r.errors.UserNotFoundError;return new s(t.message.replace("$name",e),t.code,e)}}t.ObjectNotFoundError=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(10);t.nameColection="account";t.Dao=class extends n.BaseMongoImpDao{constructor(){super(t.nameColection)}}}]);